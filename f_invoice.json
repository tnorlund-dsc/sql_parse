{"dm_delta": {"joins": [{"join_type": "INNER JOIN", "left": {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_id"}, "right": {"schema": "stg", "table_name": "orders", "column_name": "id"}}, {"join_type": "LEFT OUTER JOIN", "left": {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_id"}, "right": {"schema": "stg", "table_name": "erp_shipments", "column_name": "order_id"}}], "selects": [{"operation": "distinct i.customer_id", "column_name": "customer_id"}]}, "dmt.f_invoice": {"joins": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "erp_invoices", "column_name": "customer_id"}}, {"join_type": "INNER JOIN", "left": {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_id"}, "right": {"schema": "stg", "table_name": "orders", "column_name": "id"}}, {"join_type": "INNER JOIN", "left": {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_id"}, "right": {"schema": "stg", "table_name": "erp_shipments", "column_name": "order_id"}}, {"join_type": "INNER JOIN", "left": {"schema": "stg", "table_name": "erp_invoices", "column_name": "shop_id"}, "right": {"schema": "map", "table_name": "shop", "column_name": "shop_id"}}, {"join_type": "LEFT OUTER JOIN", "left": {"schema": "stg", "table_name": "erp_shipments", "column_name": "fulfillment_provider_id"}, "right": {"schema": "map", "table_name": "warehouse", "column_name": "warehouse_id"}}, {"join_type": "INNER JOIN", "left": {"schema": "stg", "table_name": "orders", "column_name": "creation_reason"}, "right": {"schema": "map", "table_name": "order_creation_reason", "column_name": "reason_id"}}, {"join_type": "INNER JOIN", "left": {"schema": "stg", "table_name": "orders", "column_name": "creation_reason"}, "right": {"schema": "map", "table_name": "order_reason", "column_name": "reason_id"}}, {"join_type": "LEFT OUTER JOIN", "left": {"schema": "stg", "table_name": "erp_shipments", "column_name": "status"}, "right": {"schema": "map", "table_name": "shipment_status", "column_name": "status_code"}}, {"join_type": "INNER JOIN", "left": {"schema": "stg", "table_name": "erp_invoices", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "customer_status", "column_name": "customer_id"}}, {"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"subquery": {"joins": [], "selects": [{"column_name": "customer_id", "table_alias": "o1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "orders", "column_name": "customer_id"}}]}, {"column_name": "first_order_id", "table_alias": "o1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "orders", "column_name": "customer_id"}}]}, {"column_name": "first_order_date", "table_alias": "o1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "orders", "column_name": "customer_id"}}]}]}, "table_name": "ocs"}}, {"join_type": "LEFT OUTER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"subquery": {"joins": [], "selects": [{"column_name": "customer_id", "table_alias": "s1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "customer_subscriptions", "column_name": "customer_id"}}]}, {"column_name": "first_subscription_start_date", "table_alias": "s1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "customer_subscriptions", "column_name": "customer_id"}}]}, {"column_name": "curr_subscription_start_date", "table_alias": "s1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "customer_subscriptions", "column_name": "customer_id"}}]}]}, "table_name": "scs"}}, {"join_type": "LEFT OUTER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"subquery": {"joins": [], "selects": [{"operation": "", "column_name": "customer_id"}]}, "table_name": "tc"}}, {"join_type": "INNER JOIN", "left": {"schema": "stg", "table_name": "erp_invoices", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "customer_initial_plan", "column_name": "customer_id"}}], "selects": [{"schema": "stg", "table_name": "erp_invoices", "column_name": "invoice_id", "column_from": "id", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_id", "column_from": "order_id", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "customer_id", "column_from": "customer_id", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_id", "column_from": "id", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "sub_total", "column_from": "sub_total", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "total_shipping", "column_from": "total_shipping", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "profit", "column_from": "profit", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "profit_margin", "column_from": "profit_margin", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "total_line_item_shipping_discount", "column_from": "total_line_item_shipping_discount", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "total_discount", "column_from": "total_discount", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "base_shipping_discount", "column_from": "base_shipping_discount", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "base_shipping", "column_from": "base_shipping", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "invoice_status", "column_from": "status", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "total_tax", "column_from": "total_tax", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "total_line_item_shipping_tax", "column_from": "total_line_item_shipping_tax", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "total_line_item_shipping", "column_from": "total_line_item_shipping", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "base_discount", "column_from": "base_discount", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "base_tax", "column_from": "base_tax", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "total_shipping_discount", "column_from": "total_shipping_discount", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "grand_total", "column_from": "grand_total", "table_alias": "i"}, {"operation": "(ISNULL(i.grand_total, 0) - ISNULL(i.total_tax, 0))", "column_name": "amount_true"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "total_line_item_discount", "column_from": "total_line_item_discount", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "total_line_item_tax", "column_from": "total_line_item_tax", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "invoice_created_at", "column_from": "created_at", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "base_shipping_tax", "column_from": "base_shipping_tax", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "total_cost", "column_from": "total_cost", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "total_shipping_tax", "column_from": "total_shipping_tax", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "balance", "column_from": "balance", "table_alias": "i"}, {"column_name": "first_order_date", "table_alias": "ocs", "subquery": {"joins": [], "selects": [{"column_name": "customer_id", "table_alias": "o1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "orders", "column_name": "customer_id"}}]}, {"column_name": "first_order_id", "table_alias": "o1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "orders", "column_name": "customer_id"}}]}, {"column_name": "first_order_date", "table_alias": "o1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "orders", "column_name": "customer_id"}}]}]}}, {"operation": "DATE_TRUNC('month', ocs.first_order_date)::date", "column_name": "first_order_month"}, {"column_name": "first_subscription_date", "table_alias": "scs", "subquery": {"joins": [], "selects": [{"column_name": "customer_id", "table_alias": "s1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "customer_subscriptions", "column_name": "customer_id"}}]}, {"column_name": "first_subscription_start_date", "table_alias": "s1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "customer_subscriptions", "column_name": "customer_id"}}]}, {"column_name": "curr_subscription_start_date", "table_alias": "s1", "subquery": [{"join_type": "INNER JOIN", "left": {"schema": "dm_delta", "table_name": "dm_delta", "column_name": "customer_id"}, "right": {"schema": "stg", "table_name": "customer_subscriptions", "column_name": "customer_id"}}]}]}}, {"operation": "DATE_TRUNC('month', scs.first_subscription_start_date)::date", "column_name": "first_subscription_month"}, {"operation": "case when ocs.first_order_id = i.order_id then TRUE else FALSE end", "column_name": "initial_invoice"}, {"operation": "case when ocs.first_order_id = i.order_id then 'Initial'  else 'Recurring' end", "column_name": "invoice_revenue_type"}, {"operation": "case when m_ocr.reason_id =14 then m_ocr.reason_name else case when ocs.first_order_id = i.order_id then 'Initial'  else 'Recurring' end end", "column_name": "invoice_revenue_type_name"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "customer_created_at", "column_from": "customer_created_at", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "customer_type", "column_from": "customer_type", "table_alias": "i"}, {"operation": "left(i.customer_first_name, 64)", "column_name": "customer_first_name"}, {"operation": "left(i.customer_last_name, 64)", "column_name": "customer_last_name"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "customer_gender", "column_from": "customer_gender", "table_alias": "i"}, {"operation": "left(i.customer_email, 128)", "column_name": "customer_email"}, {"schema": "stg", "table_name": "orders", "column_name": "order_created_at", "column_from": "created_at", "table_alias": "o"}, {"schema": "stg", "table_name": "orders", "column_name": "order_updated_at", "column_from": "updated_at", "table_alias": "o"}, {"schema": "stg", "table_name": "orders", "column_name": "order_created_by", "column_from": "created_by", "table_alias": "o"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_base_shipping_charges", "column_from": "order_base_shipping_charges", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_creation_reason", "column_from": "order_creation_reason", "table_alias": "i"}, {"schema": "stg", "table_name": "orders", "column_name": "order_creation_reason_id", "column_from": "creation_reason", "table_alias": "o"}, {"operation": "case when m_ocr.reason_id is null then 'Other' else m_ocr.reason_name end", "column_name": "order_creation_reason_name"}, {"operation": "case when m_or.reason_id is null then 'Other' else m_or.reason_name end", "column_name": "order_reason_name"}, {"operation": "case when o.creation_reason = 14 then 'true' else 'false' end", "column_name": "nsrq"}, {"operation": "case when o.creation_reason = 14 and (o.created_at <  DATE_TRUNC('day', scs.first_subscription_start_date) OR scs.first_subscription_start_date is null) THEN 'true' else 'false' end", "column_name": "nsrq_guest_purchase"}, {"operation": "case when datediff(second, scs.curr_subscription_start_date, o.created_at) between 0 and 60 then 'true' else 'false' end", "column_name": "funnel_purchase_subscription"}, {"operation": "case when datediff(second, scs.first_subscription_start_date, o.created_at) between 0 and 60 then 'true' else 'false' end", "column_name": "initial_purchase_customer"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_creation_source", "column_from": "order_creation_source", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_currency_code", "column_from": "order_currency_code", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_discount", "column_from": "order_discount", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_ignore_shipping_charges", "column_from": "order_ignore_shipping_charges", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_is_on_the_house", "column_from": "order_is_on_the_house", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_shipping_charges", "column_from": "order_shipping_charges", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "shop_id", "column_from": "shop_id", "table_alias": "i"}, {"operation": "case when m_shop.shop_id is null then 'Other' else m_shop.shop_name end", "column_name": "shop_name"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_sub_total", "column_from": "order_sub_total", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_tax", "column_from": "order_tax", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_total", "column_from": "order_total", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_total_shipping_charges", "column_from": "order_total_shipping_charges", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "tax_rate_id", "column_from": "tax_rate_id", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "tax_rate_country", "column_from": "tax_rate_country", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "tax_rate_state_province", "column_from": "tax_rate_state_province", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "tax_rate_county", "column_from": "tax_rate_county", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "tax_rate_post_code", "column_from": "tax_rate_post_code", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "tax_rate", "column_from": "tax_rate", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "shipping_address_id", "column_from": "shipping_address_id", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "shipping_address_country", "column_from": "shipping_address_country", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "shipping_address_state_province", "column_from": "shipping_address_state_province", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "shipping_address_post_code", "column_from": "shipping_address_post_code", "table_alias": "i"}, {"schema": "stg", "table_name": "orders", "column_name": "customer_subscription_id", "column_from": "customer_subscription_id", "table_alias": "o"}, {"schema": "stg", "table_name": "orders", "column_name": "coupon_instance_id", "column_from": "coupon_instance_id", "table_alias": "o"}, {"schema": "stg", "table_name": "orders", "column_name": "confirmation_email_instance_id", "column_from": "confirmation_email_instance_id", "table_alias": "o"}, {"schema": "stg", "table_name": "orders", "column_name": "customer_subscription_bill_run_id", "column_from": "customer_subscription_bill_run_id", "table_alias": "o"}, {"operation": "case when s.id is null then FALSE else TRUE end", "column_name": "shipment_created"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_tracking_number", "column_from": "tracking_number", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_price", "column_from": "price", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_tax", "column_from": "tax", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_created_at", "column_from": "created_at", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_updated_at", "column_from": "updated_at", "table_alias": "s"}, {"operation": "left(s.status, 32)", "column_name": "shipment_status_code"}, {"operation": "case when m_ss.status_code is null then 'Other' else m_ss.status_name end", "column_name": "shipment_status_name"}, {"operation": "case when m_ss.status_code is null then 'Other' else m_ss.push_status end", "column_name": "shipment_push_status"}, {"operation": "left(s.provider_status, 64)", "column_name": "shipment_provider_status"}, {"operation": "left(s.provider_method, 64)", "column_name": "shipment_provider_method"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_total_weight", "column_from": "total_weight", "table_alias": "s"}, {"operation": "CASE WHEN s.total_weight  <= 9 THEN '00' + ceiling(s.total_weight)::varchar(16) + ' oz' WHEN s.total_weight  <= 15 THEN '0' + ceiling(s.total_weight)::varchar(16) + ' oz' WHEN s.total_weight  <= 16 THEN '1 lb' WHEN s.total_weight  > 15 THEN ceiling(s.total_weight / 16.0)::varchar(16) + ' lbs' END ", "column_name": "shipment_weight_tier"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_packaging_weight", "column_from": "packaging_weight", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_contents_weight", "column_from": "contents_weight", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_delivered_at", "column_from": "delivered_at", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_fulfillment_provider_id", "column_from": "fulfillment_provider_id", "table_alias": "s"}, {"operation": "left(s.fulfillment_provider_name, 64)", "column_name": "shipment_fulfillment_provider_name"}, {"operation": "case when m_warehouse.warehouse_id is null then 'Other' else m_warehouse.warehouse_name end", "column_name": "warehouse_name"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_inventory_location_id", "column_from": "inventory_location_id", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_order_fulfillment_id", "column_from": "order_fulfillment_id", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_shipped_at", "column_from": "shipped_at", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_cost", "column_from": "shipment_cost", "table_alias": "s"}, {"schema": "stg", "table_name": "erp_shipments", "column_name": "shipment_handling_cost", "column_from": "handling_cost", "table_alias": "s"}, {"operation": "case when m_or.reason_id is null then 'Regular' else m_or.reason_name end", "column_name": "shipment_type"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "cost_calculation_completed", "column_from": "cost_calculation_completed", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "billing_address_id", "column_from": "billing_address_id", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "billing_address_country", "column_from": "billing_address_country", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "billing_address_state_province", "column_from": "billing_address_state_province", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "billing_address_post_code", "column_from": "billing_address_post_code", "table_alias": "i"}, {"operation": "getdate()", "column_name": "dw_load_date_time"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_attribution_id", "column_from": "order_attribution_id", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_attribution_attribution_id", "column_from": "order_attribution_attribution_id", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_attribution_attribution_type", "column_from": "order_attribution_attribution_type", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_attribution_created_at", "column_from": "order_attribution_created_at", "table_alias": "i"}, {"schema": "stg", "table_name": "erp_invoices", "column_name": "order_attribution_updated_at", "column_from": "order_attribution_updated_at", "table_alias": "i"}, {"operation": "case when i.order_id = nvl(cip.order_id, 000000000) then TRUE else FALSE end", "column_name": "plan_initial_invoice"}, {"operation": "case when s.uuid is null then s.id::varchar else s.uuid end", "column_name": "shipment_uuid"}, {"operation": "case when s.primary_shipment_uuid is null and s.uuid is null and s.shipped_at is not null then s.id::varchar else s.primary_shipment_uuid end", "column_name": "primary_shipment_uuid"}]}}